<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>NAP-NAP –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∞</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell;
      margin: 0;
      padding: 0;
    }
    
    body {
      overflow: hidden;
      position: relative;
      color: #1c1c1e;
      touch-action: manipulation;
      height: 100vh;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    #canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 0;
      width: 100%;
      height: 100%;
    }
    
    .container {
      position: relative;
      z-index: 1;
      padding: 20px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    input, button {
      border: 1px solid #c7c7cc;
      border-radius: 10px;
      padding: 16px;
      font-size: 18px;
      background: rgba(255, 255, 255, 0.7);
      color: #1c1c1e;
    }
    
    input[type="text"] {
      flex: 1;
    }
    
    .task-list-wrapper {
      flex: 1;
      overflow-y: auto;
      padding-right: 5px;
      -webkit-overflow-scrolling: touch;
    }
    
    .task-item {
      display: flex;
      align-items: flex-start;
      padding: 15px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
      gap: 12px;
    }
    
    .task-item.dragging {
      opacity: 0.8;
      transform: scale(1.02);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }
    
    .drag-handle {
      cursor: move;
      padding: 5px;
      font-size: 20px;
      flex-shrink: 0;
      align-self: center;
      color: #666;
    }
    
    .task-content {
      flex: 1;
      min-width: 0;
      overflow: hidden;
    }
    
    .task-text {
      word-wrap: break-word;
      line-height: 1.4;
      font-size: 18px;
      margin-bottom: 8px;
    }
    
    .task-text[contenteditable="true"] {
      outline: none;
      padding: 5px;
      border-radius: 6px;
      background: rgba(255,255,255,0.3);
    }
    
    .task-text[contenteditable="true"]:focus {
      background: rgba(255,255,255,0.5);
    }
    
    .date-display {
      font-size: 14px;
      color: #555;
      background: rgba(0,0,0,0.05);
      padding: 4px 8px;
      border-radius: 8px;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    
    .task-actions {
      display: flex;
      flex-shrink: 0;
      gap: 10px;
      align-items: center;
    }
    
    .calendar-btn, .delete-btn {
      background: transparent;
      border: none;
      font-size: 22px;
      cursor: pointer;
      flex-shrink: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
      color: #555;
    }
    
    .calendar-btn:hover, .delete-btn:hover {
      background: rgba(0,0,0,0.1);
    }
    
    .task-item::before {
      content: '';
      position: absolute;
      top: -10%;
      left: -10%;
      width: 120%;
      height: 120%;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      z-index: -1;
      transform: scale(1);
      animation: pulseBg 4s ease-in-out infinite;
    }
    
    @keyframes pulseBg {
      0%, 100% {
        transform: scale(1);
        opacity: 0.3;
      }
      50% {
        transform: scale(1.05);
        opacity: 0.5;
      }
    }
    
    .task-item::after {
      content: '';
      position: absolute;
      pointer-events: none;
      top: var(--mouse-y, 50%);
      left: var(--mouse-x, 50%);
      width: 120px;
      height: 120px;
      transform: translate(-50%, -50%) scale(4);
      border-radius: 50%;
      background: radial-gradient(rgba(255,255,255,0.3), transparent 70%);
      opacity: 0;
      transition: opacity 0.4s;
      z-index: -1;
    }
    
    .task-item:hover::after {
      opacity: 1;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div class="container">
    <div class="input-group">
      <input type="text" id="taskInput" placeholder="–ù–æ–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ" />
      <button onclick="addTask()">+</button>
    </div>
    
    <div class="task-list-wrapper" id="taskList"></div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ —á–∞—Å—Ç–∏—Ü–∞–º–∏
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Å—Ç–∏—Ü
    const particles = [];
    const numParticles = 60;
    const colors = [
      '#FF9AA2', '#FFB7B2', '#FFDAC1', 
      '#E2F0CB', '#B5EAD7', '#C7CEEA',
      '#F8B195', '#F67280', '#C06C84',
      '#6C5B7B', '#355C7D'
    ];

    class Particle {
      constructor() {
        this.reset();
        this.y = Math.random() * canvas.height;
      }
      
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = -20;
        this.size = Math.random() * 5 + 2;
        this.speed = Math.random() * 2 + 1;
        this.color = colors[Math.floor(Math.random() * colors.length)];
        this.opacity = Math.random() * 0.6 + 0.2;
        this.angle = Math.random() * Math.PI * 2;
        this.velocity = Math.random() * 0.2 - 0.1;
      }
      
      update() {
        this.angle += this.velocity;
        this.x += Math.sin(this.angle) * 0.5;
        this.y += this.speed;
        
        if (this.y > canvas.height + 20) {
          this.reset();
        }
      }
      
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.globalAlpha = this.opacity;
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
    for (let i = 0; i < numParticles; i++) {
      particles.push(new Particle());
    }

    function animate() {
      // –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
      ctx.fillStyle = 'rgba(245, 247, 250, 0.1)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
      particles.forEach(p => {
        p.update();
        p.draw();
        
        // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–ª–∏–∑–∫–∏—Ö —á–∞—Å—Ç–∏—Ü
        particles.forEach(p2 => {
          if (p === p2) return;
          const dx = p.x - p2.x;
          const dy = p.y - p2.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          
          if (distance < 100) {
            ctx.beginPath();
            ctx.strokeStyle = p.color;
            ctx.globalAlpha = (1 - distance / 100) * 0.3;
            ctx.lineWidth = 0.5;
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
            ctx.globalAlpha = 1;
          }
        });
      });
      
      requestAnimationFrame(animate);
    }
    animate();

    // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let currentEditIndex = null;
    let dragStartIndex = null;
    let touchStartTime = 0;
    let touchStartY = 0;
    let longPressTimer = null;

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function renderTasks() {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';
      
      tasks.forEach((task, index) => {
        const item = document.createElement('div');
        item.className = 'task-item';
        item.dataset.index = index;

        const dragHandle = document.createElement('div');
        dragHandle.innerHTML = '‚ò∞';
        dragHandle.className = 'drag-handle';
        dragHandle.addEventListener('touchstart', handleTouchStart);
        dragHandle.addEventListener('touchmove', handleTouchMove);
        dragHandle.addEventListener('touchend', handleTouchEnd);
        dragHandle.addEventListener('mousedown', handleMouseDown);
        
        const contentWrapper = document.createElement('div');
        contentWrapper.className = 'task-content';
        
        const textDiv = document.createElement('div');
        textDiv.className = 'task-text';
        textDiv.textContent = task.text;
        textDiv.setAttribute('contenteditable', 'true');
        textDiv.addEventListener('blur', () => {
          tasks[index].text = textDiv.textContent.trim();
          saveTasks();
        });
        
        contentWrapper.appendChild(textDiv);
        
        if (task.datetime) {
          const dateElem = document.createElement('div');
          dateElem.className = 'date-display';
          dateElem.textContent = new Date(task.datetime).toLocaleString();
          contentWrapper.appendChild(dateElem);
        }

        const actionsWrapper = document.createElement('div');
        actionsWrapper.className = 'task-actions';
        
        const calendarBtn = document.createElement('button');
        calendarBtn.innerHTML = 'üìÖ';
        calendarBtn.className = 'calendar-btn';
        calendarBtn.onclick = () => openDateTimePicker(index);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '‚úï';
        deleteBtn.className = 'delete-btn';
        deleteBtn.onclick = () => deleteTask(index);

        actionsWrapper.appendChild(calendarBtn);
        actionsWrapper.appendChild(deleteBtn);
        
        item.appendChild(dragHandle);
        item.appendChild(contentWrapper);
        item.appendChild(actionsWrapper);
        taskList.appendChild(item);
      });
    }

    function addTask() {
      const input = document.getElementById('taskInput');
      const text = input.value.trim();
      if (text) {
        tasks.unshift({ 
          text,
          datetime: null
        });
        input.value = '';
        saveTasks();
        renderTasks();
        
        setTimeout(() => {
          const taskList = document.getElementById('taskList');
          if (taskList.firstChild) {
            taskList.firstChild.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }
        }, 100);
      } else {
        input.focus();
      }
    }

    function deleteTask(index) {
      if (confirm('–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ?')) {
        tasks.splice(index, 1);
        saveTasks();
        renderTasks();
      }
    }
    
    function openDateTimePicker(index) {
      currentEditIndex = index;

      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100%';
      modal.style.height = '100%';
      modal.style.background = 'rgba(0,0,0,0.7)';
      modal.style.display = 'flex';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.style.zIndex = '1000';

      const pickerBox = document.createElement('div');
      pickerBox.style.background = 'rgba(255,255,255,0.95)';
      pickerBox.style.padding = '25px';
      pickerBox.style.borderRadius = '16px';
      pickerBox.style.boxShadow = '0 10px 30px rgba(0,0,0,0.3)';
      pickerBox.style.width = '90%';
      pickerBox.style.maxWidth = '400px';
      pickerBox.innerHTML = `
        <h3 style="margin-bottom: 15px; text-align: center;">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</h3>
        <label style="display: block; margin-bottom: 20px;">
          –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:
          <input type="datetime-local" id="datetimeInput" value="${tasks[index].datetime || ''}" 
                 style="width: 100%; margin-top: 8px; padding: 12px; border-radius: 10px; border: 1px solid #ccc; font-size: 16px;">
        </label>
        <div style="display: flex; gap: 10px;">
          <button id="saveBtn" style="flex: 1; padding: 14px; background: #007AFF; color: white; border: none; border-radius: 10px; font-size: 16px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="cancelBtn" style="flex: 1; padding: 14px; background: #f0f0f0; border: none; border-radius: 10px; font-size: 16px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
      `;

      modal.appendChild(pickerBox);
      document.body.appendChild(modal);
      
      setTimeout(() => {
        const input = document.getElementById('datetimeInput');
        input.focus();
      }, 100);

      document.getElementById('saveBtn').onclick = () => {
        const value = document.getElementById('datetimeInput').value;
        tasks[currentEditIndex].datetime = value;
        document.body.removeChild(modal);
        saveTasks();
        renderTasks();
      };

      document.getElementById('cancelBtn').onclick = () => {
        document.body.removeChild(modal);
      };
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    function handleTouchStart(e) {
      touchStartTime = Date.now();
      touchStartY = e.touches[0].clientY;
      const taskItem = e.target.closest('.task-item');
      
      longPressTimer = setTimeout(() => {
        dragStartIndex = parseInt(taskItem.dataset.index);
        taskItem.classList.add('dragging');
        taskItem.style.zIndex = '100';
        e.preventDefault();
      }, 300);
    }
    
    function handleTouchMove(e) {
      if (dragStartIndex === null) return;
      e.preventDefault();
      
      const taskList = document.getElementById('taskList');
      const taskItems = Array.from(taskList.querySelectorAll('.task-item'));
      const draggingItem = taskItems.find(item => 
        parseInt(item.dataset.index) === dragStartIndex
      );
      
      if (!draggingItem) return;
      
      const touchY = e.touches[0].clientY;
      draggingItem.style.transform = `translateY(${touchY - touchStartY}px)`;
      
      const taskElements = taskItems.filter(item => item !== draggingItem);
      const targetElement = taskElements.find(item => {
        const rect = item.getBoundingClientRect();
        return touchY >= rect.top && touchY <= rect.bottom;
      });
      
      if (targetElement) {
        const targetIndex = parseInt(targetElement.dataset.index);
        swapTasks(dragStartIndex, targetIndex);
        dragStartIndex = targetIndex;
        draggingItem.dataset.index = targetIndex;
      }
    }
    
    function handleTouchEnd() {
      clearTimeout(longPressTimer);
      if (dragStartIndex === null) return;
      
      const taskItems = document.querySelectorAll('.task-item');
      taskItems.forEach(item => {
        item.classList.remove('dragging');
        item.style.transform = '';
        item.style.zIndex = '';
      });
      
      dragStartIndex = null;
      saveTasks();
    }
    
    function handleMouseDown(e) {
      const taskItem = e.target.closest('.task-item');
      dragStartIndex = parseInt(taskItem.dataset.index);
      taskItem.classList.add('dragging');
      taskItem.style.zIndex = '100';
      
      const startY = e.clientY;
      const startIndex = dragStartIndex;
      
      function handleMouseMove(e) {
        const mouseY = e.clientY;
        taskItem.style.transform = `translateY(${mouseY - startY}px)`;
        
        const taskList = document.getElementById('taskList');
        const taskItems = Array.from(taskList.querySelectorAll('.task-item'));
        const otherItems = taskItems.filter(item => item !== taskItem);
        
        const targetElement = otherItems.find(item => {
          const rect = item.getBoundingClientRect();
          return mouseY >= rect.top && mouseY <= rect.bottom;
        });
        
        if (targetElement) {
          const targetIndex = parseInt(targetElement.dataset.index);
          swapTasks(dragStartIndex, targetIndex);
          dragStartIndex = targetIndex;
          taskItem.dataset.index = targetIndex;
        }
      }
      
      function handleMouseUp() {
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
        
        taskItem.classList.remove('dragging');
        taskItem.style.transform = '';
        taskItem.style.zIndex = '';
        
        dragStartIndex = null;
        saveTasks();
      }
      
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
    }
    
    function swapTasks(fromIndex, toIndex) {
      if (fromIndex === toIndex) return;
      
      const temp = tasks[fromIndex];
      tasks[fromIndex] = tasks[toIndex];
      tasks[toIndex] = temp;
      
      const taskItems = document.querySelectorAll('.task-item');
      taskItems[fromIndex].dataset.index = fromIndex;
      taskItems[toIndex].dataset.index = toIndex;
      
      renderTasks();
    }
    
    document.addEventListener('mousemove', function(e) {
      document.querySelectorAll('.task-item').forEach(item => {
        const rect = item.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        item.style.setProperty('--mouse-x', `${x}%`);
        item.style.setProperty('--mouse-y', `${y}%`);
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
      renderTasks();
      
      document.getElementById('taskInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addTask();
      });
      
      if (localStorage.getItem('tasks') === null) {
        tasks = [
          { text: "–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ", datetime: null },
          { text: "–ù–∞–∂–º–∏—Ç–µ üìÖ —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É", datetime: null },
          { text: "–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ ‚ò∞ —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å", datetime: null }
        ];
        saveTasks();
        renderTasks();
      }
    });
  </script>
</body>
</html>