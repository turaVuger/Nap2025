<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>NAP-NAP –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∞</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell;
    }
    body {
      margin: 0;
      overflow: hidden;
      position: relative;
      color: #1c1c1e;
      touch-action: manipulation;
    }
    #canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 0;
      width: 100%;
      height: 100%;
    }
    .container {
      position: relative;
      z-index: 1;
      padding: 20px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    input, button {
      border: 1px solid #c7c7cc;
      border-radius: 10px;
      padding: 16px;
      font-size: 18px;
      background: rgba(255, 255, 255, 0.2);
    }
    input[type="text"] {
      flex: 1;
    }
    .task-list-wrapper {
      flex: 1;
      overflow-y: auto;
      padding-right: 5px;
      -webkit-overflow-scrolling: touch;
    }
    .task-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      margin-bottom: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(6px);
      transition: transform 0.2s;
      touch-action: none;
    }
    
    .task-item.dragging {
      opacity: 0.7;
      transform: scale(1.02);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .task-text {
      flex: 1;
      margin-left: 10px;
    }
    .delete-btn {
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
      z-index: 1;
    }

    .task-item::before {
      content: '';
      position: absolute;
      top: -10%;
      left: -10%;
      width: 120%;
      height: 120%;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      z-index: -1;
      transform: scale(1);
      animation: pulseBg 4s ease-in-out infinite;
    }

    @keyframes pulseBg {
      0%, 100% {
        transform: scale(1);
        opacity: 0.2;
      }
      50% {
        transform: scale(1.05);
        opacity: 0.4;
      }
    }

    .task-item::after {
      content: '';
      position: absolute;
      pointer-events: none;
      top: var(--mouse-y, 50%);
      left: var(--mouse-x, 50%);
      width: 100px;
      height: 100px;
      transform: translate(-50%, -50%) scale(5);
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(4px);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: -1;
    }

    .task-item:hover::after {
      opacity: 1;
    }
    
    .date-display {
      font-size: 14px;
      color: #555;
      margin-top: 5px;
    }
    
    .drag-handle {
      cursor: move;
      padding: 8px;
      margin-right: 5px;
      font-size: 18px;
      z-index: 1;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div class="container">
    <div class="input-group">
      <input type="text" id="taskInput" placeholder="–ù–æ–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ" />
      <button onclick="addTask()">+</button>
    </div>
    
    <div class="task-list-wrapper" id="taskList"></div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const particles = [];
    const numParticles = 70;
    const SPEED_FACTOR = 0.5;
    const G = 0.15;

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.vx = (Math.random() - 0.5) * SPEED_FACTOR;
        this.vy = (Math.random() - 0.5) * SPEED_FACTOR;
        this.mass = Math.random() * 8 + 4;
        this.color = `hsl(${Math.random() * 360}, 70%, 50%)`;
        this.parallax = Math.random() < 0.2 ? 0.7 : 1.0;
        this.type = Math.random() < 0.1 ? 'exotic' : 'normal';
      }

      update() {
        this.x += this.vx * this.parallax;
        this.y += this.vy * this.parallax;
        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
      }
    }

    for (let i = 0; i < numParticles; i++) {
      particles.push(new Particle());
    }

    function applyPhysics() {
      particles.forEach(p1 => {
        particles.forEach(p2 => {
          if (p1 === p2) return;
          const dx = p2.x - p1.x;
          const dy = p2.y - p1.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          let force = G * (p1.mass * p2.mass) / (dist * dist + 100);
          if (p1.type === 'exotic' || p2.type === 'exotic') {
            force *= Math.sin(Date.now() * 0.002) * 1.5;
          }
          p1.vx += (dx / dist) * force * SPEED_FACTOR;
          p1.vy += (dy / dist) * force * SPEED_FACTOR;
        });
      });
    }

    function drawBackground() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p1 => {
        particles.forEach(p2 => {
          if (p1 === p2) return;
          const dx = p1.x - p2.x;
          const dy = p1.y - p2.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < 120) {
            ctx.beginPath();
            ctx.strokeStyle = p1.color.replace(')', `, ${0.4 - dist / 300})`);
            ctx.lineWidth = 0.7;
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
          }
        });
        ctx.fillStyle = p1.color;
        ctx.beginPath();
        ctx.arc(p1.x, p1.y, Math.sqrt(p1.mass) * (p1.parallax < 1 ? 0.8 : 1.2), 0, Math.PI * 2);
        ctx.fill();
        if (p1.type === 'exotic') {
          ctx.strokeStyle = p1.color.replace(')', ', 0.1)');
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.arc(p1.x, p1.y, Math.sqrt(p1.mass) * 2.5, 0, Math.PI * 2);
          ctx.stroke();
        }
      });
    }

    function animate() {
      applyPhysics();
      particles.forEach(p => p.update());
      drawBackground();
      requestAnimationFrame(animate);
    }
    animate();

    // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let currentEditIndex = null;
    let dragStartIndex = null;
    let touchStartTime = 0;
    let touchStartY = 0;
    let longPressTimer = null;

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ localStorage
    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function renderTasks() {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';
      
      tasks.forEach((task, index) => {
        const item = document.createElement('div');
        item.className = 'task-item';
        item.dataset.index = index;

        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        const dragHandle = document.createElement('div');
        dragHandle.innerHTML = '‚ò∞';
        dragHandle.className = 'drag-handle';
        dragHandle.addEventListener('touchstart', handleTouchStart);
        dragHandle.addEventListener('touchmove', handleTouchMove);
        dragHandle.addEventListener('touchend', handleTouchEnd);
        dragHandle.addEventListener('mousedown', handleMouseDown);
        
        const calendarBtn = document.createElement('button');
        calendarBtn.innerHTML = 'üìÖ';
        calendarBtn.className = 'delete-btn';
        calendarBtn.style.marginRight = '8px';
        calendarBtn.onclick = () => openDateTimePicker(index);

        const textDiv = document.createElement('div');
        textDiv.className = 'task-text';
        textDiv.textContent = task.text;
        textDiv.setAttribute('contenteditable', 'true');
        textDiv.addEventListener('blur', () => {
          tasks[index].text = textDiv.textContent.trim();
          saveTasks();
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç—ã
        if (task.datetime) {
          const dateElem = document.createElement('div');
          dateElem.className = 'date-display';
          dateElem.textContent = new Date(task.datetime).toLocaleString();
          textDiv.appendChild(dateElem);
        }

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = '‚úï';
        deleteBtn.className = 'delete-btn';
        deleteBtn.onclick = () => deleteTask(index);

        item.appendChild(dragHandle);
        item.appendChild(calendarBtn);
        item.appendChild(textDiv);
        item.appendChild(deleteBtn);
        taskList.appendChild(item);
      });
    }

    function addTask() {
      const input = document.getElementById('taskInput');
      const text = input.value.trim();
      if (text) {
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤ –Ω–∞—á–∞–ª–æ –º–∞—Å—Å–∏–≤–∞
        tasks.unshift({ 
          text,
          datetime: null
        });
        input.value = '';
        saveTasks();
        renderTasks();
      }
    }

    function deleteTask(index) {
      tasks.splice(index, 1);
      saveTasks();
      renderTasks();
    }
    
    function openDateTimePicker(index) {
      currentEditIndex = index;

      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100%';
      modal.style.height = '100%';
      modal.style.background = 'rgba(0,0,0,0.4)';
      modal.style.display = 'flex';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.style.zIndex = '999';

      const pickerBox = document.createElement('div');
      pickerBox.style.background = '#fff';
      pickerBox.style.padding = '20px';
      pickerBox.style.borderRadius = '12px';
      pickerBox.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
      pickerBox.innerHTML = `
        <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:<br>
          <input type="datetime-local" id="datetimeInput" value="${tasks[index].datetime || ''}" style="margin-top:8px; padding:10px; border-radius:10px; border:1px solid #ccc;">
        </label>
        <div style="margin-top: 12px; text-align: right;">
          <button id="saveBtn" style="padding:10px 20px; margin-right:10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="cancelBtn" style="padding:10px 20px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
      `;

      modal.appendChild(pickerBox);
      document.body.appendChild(modal);

      document.getElementById('saveBtn').onclick = () => {
        const value = document.getElementById('datetimeInput').value;
        tasks[currentEditIndex].datetime = value;
        document.body.removeChild(modal);
        saveTasks();
        renderTasks();
      };

      document.getElementById('cancelBtn').onclick = () => {
        document.body.removeChild(modal);
      };
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
    function handleTouchStart(e) {
      touchStartTime = Date.now();
      touchStartY = e.touches[0].clientY;
      const taskItem = e.target.closest('.task-item');
      
      longPressTimer = setTimeout(() => {
        dragStartIndex = parseInt(taskItem.dataset.index);
        taskItem.classList.add('dragging');
        taskItem.style.zIndex = '100';
        e.preventDefault();
      }, 300); // 300ms –¥–ª—è long press
    }
    
    function handleTouchMove(e) {
      if (dragStartIndex === null) return;
      e.preventDefault();
      
      const taskList = document.getElementById('taskList');
      const taskItems = Array.from(taskList.querySelectorAll('.task-item'));
      const draggingItem = taskItems.find(item => 
        parseInt(item.dataset.index) === dragStartIndex
      );
      
      if (!draggingItem) return;
      
      const touchY = e.touches[0].clientY;
      draggingItem.style.transform = `translateY(${touchY - touchStartY}px)`;
      
      // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞—Ö–æ–¥–∏–º—Å—è
      const taskElements = taskItems.filter(item => item !== draggingItem);
      const targetElement = taskElements.find(item => {
        const rect = item.getBoundingClientRect();
        return touchY >= rect.top && touchY <= rect.bottom;
      });
      
      if (targetElement) {
        const targetIndex = parseInt(targetElement.dataset.index);
        swapTasks(dragStartIndex, targetIndex);
        dragStartIndex = targetIndex;
        draggingItem.dataset.index = targetIndex;
      }
    }
    
    function handleTouchEnd() {
      clearTimeout(longPressTimer);
      if (dragStartIndex === null) return;
      
      const taskItems = document.querySelectorAll('.task-item');
      taskItems.forEach(item => {
        item.classList.remove('dragging');
        item.style.transform = '';
        item.style.zIndex = '';
      });
      
      dragStartIndex = null;
      saveTasks();
    }
    
    function handleMouseDown(e) {
      const taskItem = e.target.closest('.task-item');
      dragStartIndex = parseInt(taskItem.dataset.index);
      taskItem.classList.add('dragging');
      taskItem.style.zIndex = '100';
      
      const startY = e.clientY;
      const startIndex = dragStartIndex;
      
      function handleMouseMove(e) {
        const mouseY = e.clientY;
        taskItem.style.transform = `translateY(${mouseY - startY}px)`;
        
        const taskList = document.getElementById('taskList');
        const taskItems = Array.from(taskList.querySelectorAll('.task-item'));
        const otherItems = taskItems.filter(item => item !== taskItem);
        
        // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞—Ö–æ–¥–∏–º—Å—è
        const targetElement = otherItems.find(item => {
          const rect = item.getBoundingClientRect();
          return mouseY >= rect.top && mouseY <= rect.bottom;
        });
        
        if (targetElement) {
          const targetIndex = parseInt(targetElement.dataset.index);
          swapTasks(dragStartIndex, targetIndex);
          dragStartIndex = targetIndex;
          taskItem.dataset.index = targetIndex;
        }
      }
      
      function handleMouseUp() {
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
        
        taskItem.classList.remove('dragging');
        taskItem.style.transform = '';
        taskItem.style.zIndex = '';
        
        dragStartIndex = null;
        saveTasks();
      }
      
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
    }
    
    function swapTasks(fromIndex, toIndex) {
      if (fromIndex === toIndex) return;
      
      // –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –∑–∞–¥–∞—á–∏
      const temp = tasks[fromIndex];
      tasks[fromIndex] = tasks[toIndex];
      tasks[toIndex] = temp;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –≤ DOM
      const taskItems = document.querySelectorAll('.task-item');
      taskItems[fromIndex].dataset.index = fromIndex;
      taskItems[toIndex].dataset.index = toIndex;
      
      renderTasks();
    }
      
    document.addEventListener('mousemove', function(e) {
      document.querySelectorAll('.task-item').forEach(item => {
        const rect = item.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        item.style.setProperty('--mouse-x', `${x}%`);
        item.style.setProperty('--mouse-y', `${y}%`);
      });
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
      renderTasks();
    });
  </script>
</body>
</html>